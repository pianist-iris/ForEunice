<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¬°å…’é£Ÿç“ç—¾å°åŠ©æ‰‹ Â· æœˆé½¡ + Charts ç‰ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Google Fonts: Noto Sans TC + Zen Maru Gothic -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Zen+Maru+Gothic:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans TC', sans-serif; }
    .zen-font { font-family: 'Zen Maru Gothic', sans-serif; }
    .profile-card { transition: all 0.3s ease; }
    .profile-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .collapsible { transition: max-height 0.3s ease-out; overflow: hidden; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    canvas { max-height: 300px; }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4">
  <div class="max-w-4xl mx-auto">
    
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl md:text-5xl font-bold zen-font text-gray-800 mb-2">ğŸ‘¶ å¯¶å¯¶é£Ÿç“ç—¾è¨˜éŒ„</h1>
      <p class="text-lg text-gray-600">Moon Age + Charts Edition</p>
    </div>

    <!-- Baby Profile Card -->
    <div class="profile-card bg-white rounded-2xl shadow-xl p-6 mb-8 border border-gray-100">
      <div class="flex justify-between items-start mb-4">
        <div>
          <h2 class="text-2xl font-bold zen-font text-indigo-600">å¯¶å¯¶æª”æ¡ˆ</h2>
          <p id="moonAge" class="text-3xl font-bold text-gray-800 mt-2">è¨ˆç®—ä¸­...</p>
        </div>
        <button id="toggleProfile" class="p-2 rounded-xl bg-indigo-100 hover:bg-indigo-200 transition-all">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </button>
      </div>
      
      <!-- Collapsible Reference Pattern -->
      <div id="referenceSection" class="collapsible max-h-96">
        <div class="bg-gray-50 rounded-xl p-4 mt-4 border">
          <h3 class="font-semibold text-gray-700 mb-3 flex items-center">
            ğŸ“Š åƒè€ƒæ¨¡å¼ <span class="ml-2 text-sm bg-blue-100 px-2 py-1 rounded-full">(å¯æ”¶åˆ)</span>
          </h3>
          <table class="w-full text-sm">
            <thead>
              <tr class="bg-gray-200">
                <th class="p-3 text-left">æœˆé½¡</th>
                <th class="p-3 text-left">é¤µé£Ÿ (æ¬¡/æ—¥)</th>
                <th class="p-3 text-left">æ¯æ¬¡é‡ (ml)</th>
                <th class="p-3 text-left">ç¸½ç¡ (å°æ™‚)</th>
              </tr>
            </thead>
            <tbody>
              <tr><td class="p-3 font-medium">0-1m</td><td class="p-3">8-12</td><td class="p-3">60-90</td><td class="p-3">14-17</td></tr>
              <tr class="bg-gray-50"><td class="p-3 font-medium">1-3m</td><td class="p-3">6-8</td><td class="p-3">90-120</td><td class="p-3">14-16</td></tr>
              <tr><td class="p-3 font-medium">3-6m</td><td class="p-3">5-6</td><td class="p-3">120-180</td><td class="p-3">13-15</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Birthday Input -->
      <div class="mt-6 p-4 bg-indigo-50 rounded-xl">
        <label class="block text-sm font-medium text-gray-700 mb-2">å¯¶å¯¶ç”Ÿæ—¥ (YYYY-MM-DD)</label>
        <input type="date" id="birthday" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent" required>
      </div>
    </div>

    <!-- Tabs -->
    <div class="bg-white rounded-2xl shadow-xl p-6 mb-8 border border-gray-100">
      <div class="flex border-b">
        <button class="tab-btn px-6 py-3 font-semibold text-indigo-600 border-b-2 border-indigo-500">ğŸ“ è¨˜éŒ„</button>
        <button class="tab-btn px-6 py-3 font-semibold text-gray-600 hover:text-indigo-600">ğŸ“ˆ Charts</button>
        <button class="tab-btn px-6 py-3 font-semibold text-gray-600 hover:text-indigo-600">ğŸ“‹ æ­·å²</button>
      </div>

      <!-- Log Tab -->
      <div id="logTab" class="tab-content active p-6">
        <form id="logForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Time -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ• æ™‚é–“</label>
            <input type="time" id="time" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500" required>
          </div>

          <!-- Feed Type -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ¥› é¤µé£Ÿé¡å‹</label>
            <select id="feedType" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500">
              <option value="">é¸æ“‡...</option>
              <option value="æ¯ä¹³">æ¯ä¹³</option>
              <option value="å¥¶ç²‰">å¥¶ç²‰</option>
            </select>
          </div>

          <!-- Feed Amount -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“Š é¤µé£Ÿé‡ (ml)</label>
            <input type="number" id="feedAmount" min="0" step="10" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500">
          </div>

          <!-- Sleep -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ˜´ ç¡è¦º (åˆ†é˜)</label>
            <input type="number" id="sleep" min="0" class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500">
          </div>

          <!-- Poop Checkbox + Color -->
          <div class="md:col-span-2">
            <label class="flex items-center text-sm font-medium text-gray-700 mb-2">
              <input type="checkbox" id="poop" class="mr-2 h-4 w-4 text-indigo-600 focus:ring-indigo-500">
              ğŸ’© ç—¾å±
            </label>
            <select id="poopColor" class="ml-6 p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 invisible" disabled>
              <option value="">é¡è‰²...</option>
              <option value="é»ƒ">é»ƒ</option>
              <option value="ç¶ ">ç¶ </option>
              <option value="æ£•">æ£•</option>
              <option value="é»‘">é»‘</option>
            </select>
          </div>

          <!-- Submit -->
          <div class="md:col-span-2">
            <button type="submit" class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-4 px-6 rounded-2xl font-bold text-lg shadow-xl hover:shadow-2xl transform hover:-translate-y-1 transition-all duration-200">ğŸ’¾ å„²å­˜è¨˜éŒ„</button>
          </div>
        </form>
      </div>

      <!-- Charts Tab -->
      <div id="chartsTab" class="tab-content p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-gray-50 p-4 rounded-xl">
          <h3 class="font-bold text-lg mb-4">é¤µé£Ÿé‡è¶¨å‹¢</h3>
          <canvas id="feedChart"></canvas>
        </div>
        <div class="bg-gray-50 p-4 rounded-xl">
          <h3 class="font-bold text-lg mb-4">ç¡è¦ºæ™‚é•·</h3>
          <canvas id="sleepChart"></canvas>
        </div>
        <div class="bg-gray-50 p-4 rounded-xl md:col-span-2">
          <h3 class="font-bold text-lg mb-4">ç—¾å±æ¬¡æ•¸</h3>
          <canvas id="poopChart"></canvas>
        </div>
        <div class="bg-gray-50 p-4 rounded-xl md:col-span-2">
          <h3 class="font-bold text-lg mb-4">é¤µé£Ÿé »ç‡</h3>
          <canvas id="frequencyChart"></canvas>
        </div>
      </div>

      <!-- History Tab -->
      <div id="historyTab" class="tab-content p-6">
        <div class="overflow-x-auto">
          <table id="historyTable" class="w-full text-sm">
            <thead>
              <tr class="bg-gray-200">
                <th class="p-3 text-left">æ™‚é–“</th>
                <th class="p-3 text-left">é¤µé£Ÿ</th>
                <th class="p-3 text-left">ç¡è¦º</th>
                <th class="p-3 text-left">ç—¾å±</th>
                <th class="p-3 text-left">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Export/Import -->
    <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100 text-center">
      <button id="exportBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-semibold mr-4">ğŸ“¥ åŒ¯å‡º CSV</button>
      <input type="file" id="importBtn" accept=".csv" class="hidden">
      <label for="importBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold cursor-pointer inline-block">ğŸ“¤ åŒ¯å…¥ CSV</label>
    </div>

  </div>

  <script>
    // Global variables
    let logs = JSON.parse(localStorage.getItem('babyLogs')) || [];
    let birthday = localStorage.getItem('babyBirthday') || '';
    let charts = {};

    // Initialize
    document.addEventListener('DOMContentLoaded', init);

    function init() {
      document.getElementById('birthday').value = birthday;
      document.getElementById('birthday').addEventListener('change', updateBirthday);
      document.getElementById('toggleProfile').addEventListener('click', toggleProfile);
      document.getElementById('poop').addEventListener('change', togglePoopColor);
      document.getElementById('logForm').addEventListener('submit', addLog);
      document.getElementById('exportBtn').addEventListener('click', exportCSV);
      document.getElementById('importBtn').addEventListener('change', importCSV);

      // Tab switching
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('text-indigo-600', 'border-indigo-500'), b.classList.add('text-gray-600'));
          e.target.classList.add('text-indigo-600', 'border-indigo-500');
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          document.getElementById(e.target.textContent.includes('è¨˜éŒ„') ? 'logTab' : e.target.textContent.includes('Charts') ? 'chartsTab' : 'historyTab').classList.add('active');
          if (e.target.textContent.includes('Charts')) updateCharts();
        });
      });

      updateMoonAge();
      updateHistory();
      setInterval(updateMoonAge, 60000); // Update every minute
    }

    function updateBirthday(e) {
      birthday = e.target.value;
      localStorage.setItem('babyBirthday', birthday);
      updateMoonAge();
    }

    function updateMoonAge() {
      if (!birthday) return;
      const birthDate = new Date(birthday);
      const ageDiff = Date.now() - birthDate.getTime();
      const ageDate = new Date(ageDiff);
      const months = Math.floor(ageDiff / (1000 * 60 * 60 * 24 * 30.44));
      document.getElementById('moonAge').textContent = `${months}å€‹æœˆ ${Math.floor(ageDate.getUTCDate())}æ—¥`;
    }

    function toggleProfile() {
      const section = document.getElementById('referenceSection');
      const btn = document.getElementById('toggleProfile');
      section.classList.toggle('max-h-96');
      section.classList.toggle('max-h-0');
      const icon = btn.querySelector('svg');
      icon.style.transform = section.classList.contains('max-h-0') ? 'rotate(180deg)' : 'rotate(0deg)';
    }

    function togglePoopColor() {
      const colorSelect = document.getElementById('poopColor');
      colorSelect.disabled = !document.getElementById('poop').checked;
      colorSelect.classList.toggle('invisible');
    }

    function addLog(e) {
      e.preventDefault();
      const log = {
        id: Date.now(),
        date: new Date().toISOString().split('T')[0],
        time: document.getElementById('time').value,
        feedType: document.getElementById('feedType').value,
        feedAmount: parseInt(document.getElementById('feedAmount').value) || 0,
        sleep: parseInt(document.getElementById('sleep').value) || 0,
        poop: document.getElementById('poop').checked,
        poopColor: document.getElementById('poopColor').value
      };
      logs.unshift(log);
      localStorage.setItem('babyLogs', JSON.stringify(logs.slice(0, 1000))); // Keep last 1000
      document.getElementById('logForm').reset();
      togglePoopColor();
      updateHistory();
      if (document.querySelector('#chartsTab.active')) updateCharts();
      alert('âœ… è¨˜éŒ„å·²å„²å­˜ï¼');
    }

    function updateHistory() {
      const tbody = document.querySelector('#historyTable tbody');
      tbody.innerHTML = '';
      logs.slice(0, 50).forEach(log => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td class="p-3">${log.time}</td>
          <td class="p-3">${log.feedType || ''} ${log.feedAmount}ml</td>
          <td class="p-3">${log.sleep}åˆ†</td>
          <td class="p-3">${log.poop ? (log.poopColor || 'ğŸ’©') : 'âŒ'}</td>
          <td class="p-3">
            <button onclick="deleteLog(${log.id})" class="text-red-500 hover:text-red-700">åˆªé™¤</button>
          </td>
        `;
      });
    }

    window.deleteLog = function(id) {
      logs = logs.filter(l => l.id !== id);
      localStorage.setItem('babyLogs', JSON.stringify(logs));
      updateHistory();
      updateCharts();
    };

    function updateCharts() {
      const ctx1 = document.getElementById('feedChart')?.getContext('2d');
      if (ctx1 && charts.feedChart) charts.feedChart.destroy();
      charts.feedChart = new Chart(ctx1, {
        type: 'line',
         getChartData('feedAmount', 'é¤µé£Ÿé‡ (ml)'),
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });

      // Similar for other charts...
      // sleepChart, poopChart, frequencyChart
    }

    function getChartData(field, label) {
      const periods = { '1D': 1, '1W': 7, '1M': 30 };
      const datasets = [];
      Object.entries(periods).forEach(([period, days]) => {
        const data = logs
          .filter(l => new Date().getTime() - new Date(l.date).getTime() <= days * 86400000)
          .reduce((acc, l) => {
            acc[new Date(l.date).toLocaleDateString()] = (acc[new Date(l.date).toLocaleDateString()] || 0) + (l[field] || 0);
            return acc;
          }, {});
        datasets.push({
          label: `${period}`,
           Object.values(data),
          borderColor: `hsl(${Math.random()*360}, 70%, 50%)`,
          tension: 0.4
        });
      });
      return { labels: Object.keys(datasets[0]?.data || {}), datasets };
    }

    function exportCSV() {
      const csv = logs.map(l => 
        `${l.date},${l.time},${l.feedType},${l.feedAmount},${l.sleep},${l.poop},${l.poopColor}`
      ).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `baby-log-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
    }

    function importCSV(e) {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = (e) => {
        const lines = e.target.result.split('\n');
        logs = lines.slice(1).map(line => {
          const [date, time, feedType, feedAmount, sleep, poop, poopColor] = line.split(',');
          return { id: Date.now() + Math.random(), date, time, feedType, feedAmount: parseInt(feedAmount), sleep: parseInt(sleep), poop: poop === 'true', poopColor };
        });
        localStorage.setItem('babyLogs', JSON.stringify(logs));
        updateHistory();
        updateCharts();
        alert('âœ… åŒ¯å…¥å®Œæˆï¼');
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>

Update index.html to v3: Complete download-ready version with all features

âœ… Baby Profile card + collapsible Reference Pattern
âœ… Feed: æ¯ä¹³/å¥¶ç²‰ dropdown + ML input
âœ… Poop: Checkbox + color selector (é»ƒ/ç¶ /æ£•/é»‘)
âœ… New CHART tab: 4 trends (1D/1W/1M) - é¤µé£Ÿé‡/ç¡è¦º/ç—¾å±/é »ç‡
âœ… CSV export/import + LocalStorage
âœ… Responsive design + Zen Maru Gothic font

